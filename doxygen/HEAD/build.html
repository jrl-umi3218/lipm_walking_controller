<!-- Modified version of HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>lipm_walking_controller: Building from source</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('build.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Building from source </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In what follows, we assume we are starting from a fresh and up-to-date Ubuntu 16.04 system:</p>
<div class="fragment"><div class="line">ayumi:~$ sudo apt-<span class="keyword">get</span> update</div><div class="line">ayumi:~$ sudo apt-<span class="keyword">get</span> -y upgrade</div><div class="line">ayumi:~$ sudo apt-<span class="keyword">get</span> -y install cmake cython doxygen g++ git gfortran libboost1.58-all-dev libeigen3-dev libgeos++-dev libnanomsg-dev libtinyxml2-dev python-coverage python-nose python-numpy python-pip python-setuptools</div></div><!-- fragment --><h1><a class="anchor" id="jrl"></a>
JRL dependencies</h1>
<p>Suppose our username is <code>ayumi</code> and we keep source software repositories in <code>~/Software</code>. We install dependencies from <a href="https://github.com/jrl-umi3218/">jrl-umi3218</a> repositories following the standard CMake pipeline, starting with Eigen3ToPython:</p>
<div class="fragment"><div class="line">ayumi:~/Software$ git clone --recursive https:<span class="comment">//github.com/jrl-umi3218/Eigen3ToPython</span></div><div class="line">ayumi:~/Software/Eigen3ToPython/build$ cmake .. -DCMAKE_BUILD_TYPE=Release</div><div class="line">ayumi:~/Software/Eigen3ToPython/build$ make -j4</div><div class="line">ayumi:~/Software/Eigen3ToPython/build$ sudo make install</div></div><!-- fragment --><p>Apply this process to all dependencies in the following order:</p>
<ul>
<li><a href="https://github.com/jrl-umi3218/Eigen3ToPython/tree/dcc442987c3d488fd60ce7e7bcabfdf7feb847f6">Eigen3ToPython</a>: Python bindings for Eigen</li>
<li><a href="https://github.com/jrl-umi3218/SpaceVecAlg/tree/4fff3d8a45499e495498da49d24c554be22a2c47">SpaceVecAlg</a>: spatial vector algebra</li>
<li><a href="https://github.com/jrl-umi3218/RBDyn/commit/bf5dc94fbb52fe311fd17ba67da84ba07c82c2b7">RBDyn</a>: rigid body dynamics</li>
<li><a href="https://github.com/jrl-umi3218/eigen-qld/commit/434e9f684c18b5b5827b29b3a70aabacc5eb192f">eigen-qld</a>: quadratic programming</li>
<li><a href="https://github.com/jrl-umi3218/eigen-quadprog/commit/cb2d5a0e2f640d3c75a62c50e1cdab15b92342d6">eigen-quadprog</a>: quadratic programming</li>
<li><a href="https://github.com/jrl-umi3218/sch-core/commit/12959e0afc28d038f750918e33d4669612c4c2dc">sch-core</a>: collision detection</li>
<li><a href="https://github.com/jrl-umi3218/sch-core-python/commit/2890b2ccd89fdcae31fc75c7efd54f39f8239a48">sch-core-python</a>: Python bindings for collision detection</li>
<li><a href="https://github.com/jrl-umi3218/Tasks/commit/33f6b298aa3aa3f3cb24d62df4b959d1e4eede93">Tasks</a>: inverse kinematics</li>
<li><a href="https://github.com/jrl-umi3218/mc_rbdyn_urdf/commit/a85621d468aa2631640fcc226ea78df3c5c16c90">mc_rbdyn_urdf</a>: robot model loader</li>
<li><a href="https://github.com/vsamy/copra/commit/97509e74504e604305be916691c4d6217e2b7755">copra</a>: linear model predictive control</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>These links and other links below point to the commits used at the time of writing these instructions. If anything breaks in the process, you always have the option to clone these specific commits rather than the latest <code>master</code>.</dd></dl>
<h1><a class="anchor" id="ros"></a>
ROS dependencies</h1>
<p>The walking controller depends on ROS for its GUI. Make sure you install ROS Kinetic following the <a href="https://wiki.ros.org/kinetic/Installation/Ubuntu">official instructions</a>, that is:</p>
<div class="fragment"><div class="line">ayumi:~$ sudo sh -c <span class="stringliteral">&#39;echo &quot;deb http://packages.ros.org/ros/ubuntu xenial main&quot; &gt; /etc/apt/sources.list.d/ros-latest.list&#39;</span></div><div class="line">ayumi:~$ sudo apt-key adv --keyserver <span class="stringliteral">&#39;hkp://keyserver.ubuntu.com:80&#39;</span> --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654</div><div class="line">ayumi:~$ sudo apt-<span class="keyword">get</span> update</div><div class="line">ayumi:~$ sudo apt-<span class="keyword">get</span> install -y ros-kinetic-desktop ros-kinetic-eigenpy</div><div class="line">ayumi:~$ sudo rosdep init</div><div class="line">ayumi:~$ rosdep update</div><div class="line">ayumi:~$ echo <span class="stringliteral">&quot;source /opt/ros/kinetic/setup.bash&quot;</span> &gt;&gt; ~/.bashrc</div><div class="line">ayumi:~$ source ~/.bashrc</div></div><!-- fragment --><p>Now you can install one last dependency with the same CMake pipeline as above:</p>
<ul>
<li><a href="https://github.com/humanoid-path-planner/hpp-spline/commit/9f80a57a7abe14cbf23b9da57df6e5945f703804">hpp-spline</a>: spline interpolation</li>
</ul>
<p>Create your catkin workspace:</p>
<div class="fragment"><div class="line">ayumi:~$ mkdir -p ~/Software/catkin_ws/src</div><div class="line">ayumi:~/Software/catkin_ws/$ catkin_make</div></div><!-- fragment --><p>There are two ROS projects for <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader. ">mc_rtc</a>:</p>
<ul>
<li><a href="https://gite.lirmm.fr/multi-contact/mc_rtc_ros/tree/6d5b6f1bb89c446f200794d94dd3b510d456d1b8">mc_rtc_ros</a>: ROS tools for <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader. ">mc_rtc</a></li>
<li><a href="https://gite.lirmm.fr/multi-contact/mc_rtc_ros_data/tree/c3674db95d1658f2054739dc0c99eae9cfca494d">mc_rtc_ros_data</a>: ROS models for <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader. ">mc_rtc</a></li>
</ul>
<p>The installation is a bit broken here: you will need to link the second one and build once before linking the first one.</p>
<div class="fragment"><div class="line">ayumi:~/Software/catkin_ws/src/$ ln -s ~/Software/mc_rtc_ros_data</div><div class="line">ayumi:~/Software/catkin_ws/$ catkin_make -DCMAKE_BUILD_TYPE=Release</div><div class="line">ayumi:~/Software/catkin_ws/$ catkin_make install</div><div class="line">ayumi:~/Software/catkin_ws/src/$ ln -s ~/Software/mc_rtc_ros</div></div><!-- fragment --><p>From this state, we are ready to build <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader. ">mc_rtc</a>. Make sure you source catkin development files in your bash or zsh configuration as well:</p>
<div class="fragment"><div class="line">ayumi:~$ echo <span class="stringliteral">&quot;source ~/Software/catkin_ws/devel/setup.bash&quot;</span> &gt;&gt; ~/.bashrc</div></div><!-- fragment --><h1><a class="anchor" id="rtc"></a>
Building mc_rtc</h1>
<p>Once ROS data packages have been built, apply the CMake pipeline to our last dependency:</p>
<ul>
<li><a href="https://gite.lirmm.fr/multi-contact/mc_rtc/tree/e5529d0c4812bd15f33c7557f6ccea61ba0008a1">mc_rtc</a>: robot control framework</li>
</ul>
<div class="fragment"><div class="line">ayumi:~/Software$ git clone --recursive git@gite.lirmm.fr:multi-contact/<a class="code" href="namespacemc__rtc.html">mc_rtc</a>.git</div><div class="line">ayumi:~/Software/<a class="code" href="namespacemc__rtc.html">mc_rtc</a>/build$ cmake .. -DCMAKE_BUILD_TYPE=Release</div><div class="line">ayumi:~/Software/<a class="code" href="namespacemc__rtc.html">mc_rtc</a>/build$ make -j4</div><div class="line">ayumi:~/Software/<a class="code" href="namespacemc__rtc.html">mc_rtc</a>/build$ sudo make install</div></div><!-- fragment --><p>Finally, let us update our <code>LD_LIBRARY_PATH</code> so that we can link against our future controllers:</p>
<div class="fragment"><div class="line">ayumi:~$ echo <span class="stringliteral">&quot;export LD_LIBRARY_PATH=\${LD_LIBRARY_PATH}:/usr/local/lib&quot;</span> &gt;&gt; ~/.bashrc</div><div class="line">ayumi:~$ echo <span class="stringliteral">&quot;export LD_LIBRARY_PATH=\${LD_LIBRARY_PATH}:/usr/local/lib/mc_controller&quot;</span> &gt;&gt; ~/.bashrc</div></div><!-- fragment --><h1><a class="anchor" id="controller"></a>
Building the controller</h1>
<p>Now that all dependencies are installed, we can finally install the lipm_walking_controller:</p>
<div class="fragment"><div class="line">ayumi:~/Software$ git clone --recursive https:<span class="comment">//github.com/stephane-caron/lipm_walking_controller/</span></div><div class="line">ayumi:~/Software$ cd lipm_walking_controller</div><div class="line">ayumi:~/Software$ mkdir build &amp;&amp; cd build</div><div class="line">ayumi:~/Software$ cmake -DCMAKE_BUILD_TYPE=Release ..</div><div class="line">ayumi:~/Software$ make </div><div class="line">ayumi:~/Software$ sudo make install </div></div><!-- fragment --><p>To avoid installing with root privileges (sudo) you can change ownership or permissions of the <code>/usr/local/lib/mc_controller</code> folder:</p>
<div class="fragment"><div class="line">ayumi:~$ sudo chown -R ayumi:ayumi /usr/local/lib/mc_controller</div></div><!-- fragment --><h1><a class="anchor" id="choreonoid_build"></a>
Building Choreonoid</h1>
<p>You can test the controller in simulation using Choreonoid and the AIST dynamics simulator. First, install the following packages:</p>
<div class="fragment"><div class="line">ayumi:~$ sudo apt-<span class="keyword">get</span> install -y f2c gettext liblapack-dev libomniorb4-dev libyaml-dev omniidl omniidl-python software-properties-common</div></div><!-- fragment --><p>Install OpenRTM-aist 1.1.2 packages (manually distributed...):</p>
<div class="fragment"><div class="line">ayumi:~/Software$ wget https:<span class="comment">//github.com/OpenRTM/OpenRTM-aist/releases/download/svn/RELEASE_1_1_2/OpenRTM-aist_1.1.2_ubuntu16.04_amd64_package.tar.gz</span></div><div class="line">ayumi:~/Software$ tar zxvf OpenRTM-aist_1.1.2_ubuntu16.04_amd64_package.tar.gz</div><div class="line">ayumi:~/Software/OpenRTM-aist_1.1.2_ubuntu16.04_amd64_package/$ sudo dpkg -i openrtm-aist_1.1.2-0_amd64.deb</div><div class="line">ayumi:~/Software/OpenRTM-aist_1.1.2_ubuntu16.04_amd64_package/$ sudo dpkg -i openrtm-aist-dev_1.1.2-0_amd64.deb</div><div class="line">ayumi:~/Software/OpenRTM-aist_1.1.2_ubuntu16.04_amd64_package/$ sudo dpkg -i openrtm-aist-example_1.1.2-0_amd64.deb</div><div class="line">ayumi:~/Software$ rm -rf OpenRTM-aist_1.1.2_ubuntu16.04_amd64_package*</div></div><!-- fragment --><div class="fragment"><div class="line">ayumi:~/Software$ wget https:<span class="comment">//github.com/OpenRTM/OpenRTM-aist-Python/releases/download/svn%252FRELEASE_1_1_2/OpenRTM-aist-Python_1.1.2_ubuntu16.04_amd64_package.tar.gz</span></div><div class="line">ayumi:~/Software$ tar zxvf OpenRTM-aist-Python_1.1.2_ubuntu16.04_amd64_package.tar.gz</div><div class="line">ayumi:~/Software/OpenRTM-aist-Python_1.1.2_ubuntu16.04_amd64_package$ sudo dpkg -i openrtm-aist-python_1.1.2-1_amd64.deb</div><div class="line">ayumi:~/Software/OpenRTM-aist-Python_1.1.2_ubuntu16.04_amd64_package$ sudo dpkg -i openrtm-aist-python-example_1.1.2-1_amd64.deb</div><div class="line">ayumi:~/Software$ rm -rf OpenRTM-aist-Python_1.1.2_ubuntu16.04_amd64_package*</div></div><!-- fragment --><p>Install the <a href="https://github.com/fkanehiro/openhrp3/tree/53d561a288866a9ebf23c2bd07631fe4c5b91594">OpenHRP3</a> library:</p>
<div class="fragment"><div class="line">ayumi:~/Software/$ git clone --recursive https:<span class="comment">//github.com/fkanehiro/openhrp3.git</span></div><div class="line">ayumi:~/Software/openhrp3/util$ ./installPackages.sh packages.list.ubuntu.16.04</div><div class="line">ayumi:~/Software/openhrp3/build/$ cmake ..</div><div class="line">ayumi:~/Software/openhrp3/build/$ make -j4</div><div class="line">ayumi:~/Software/openhrp3/build/$ sudo make install</div></div><!-- fragment --><p>Install the <a href="https://github.com/fkanehiro/hrpsys-base/tree/5cbb5490f55c7017f7ff789c3d9de531ba92e1b6">hrpsys-base</a> suite of OpenRTM components:</p>
<div class="fragment"><div class="line">ayumi:~/Software/$ git clone --recursive https:<span class="comment">//github.com/fkanehiro/hrpsys-base.git</span></div><div class="line">ayumi:~/Software/hrpsys-base/build/$ cmake .. -DBUILD_KALMAN_FILTER=ON -DBUILD_STABILIZER=OFF</div><div class="line">ayumi:~/Software/hrpsys-base/build/$ make -j4</div><div class="line">ayumi:~/Software/hrpsys-base/build/$ sudo make install</div></div><!-- fragment --><p>Install <a href="https://github.com/s-nakaoka/choreonoid/tree/82148c9eb86310717fc90392aee9c0b63e77dd5a">Choreonoid</a>:</p>
<div class="fragment"><div class="line">ayumi:~/Software/$ git clone --branch release-1.7 https:<span class="comment">//github.com/s-nakaoka/choreonoid.git</span></div><div class="line">ayumi:~/Software/choreonoid/misc/script$ ./install-requisites-ubuntu-16.04.sh</div><div class="line">ayumi:~/Software/choreonoid/build/$ cmake .. -DENABLE_CORBA=ON -DBUILD_CORBA_PLUGIN=ON -DBUILD_OPENHRP_PLUGIN=ON -DBUILD_OPENRTM_PLUGIN=ON -DUSE_BUILTIN_CAMERA_IMAGE_IDL=ON -DUSE_PYBIND11=OFF -DUSE_PYTHON3=OFF</div><div class="line">ayumi:~/Software/choreonoid/build/$ make -j4</div><div class="line">ayumi:~/Software/choreonoid/build/$ sudo make install</div></div><!-- fragment --><h1><a class="anchor" id="jvrc"></a>
Simulation with the JVRC-1 model</h1>
<p>We will need an interface to communicate with our simulated robots. Install one of the following:</p>
<ul>
<li><a href="https://gite.lirmm.fr/multi-contact/mc_openrtm/tree/9b93983a08bbddbb186db1a0aac03105066b34e8">mc_openrtm</a>: OpenRTM interface to connect <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader. ">mc_rtc</a> with the Choreonoid simulation</li>
<li><a href="https://gite.lirmm.fr/multi-contact/mc_udp/tree/0cefb1ab0743718eaab2251d2008b0fb119eb143">mc_udp</a>: optional, install if your robot has a UDP interface (for instance HRP-4)</li>
</ul>
<p>Then, install the Choreonoid project files from the following repository using the standard CMake pipeline:</p>
<ul>
<li><a href="https://gite.lirmm.fr/multi-contact/jvrc_choreonoid/tree/aaa0998db6e9a8b23ef3f04238948ee54ee00fec">jvrc_choreonoid</a>: JVRC-1 robot model and project files</li>
</ul>
<p>Go to <code>~/.config/Choreonoid/Choreonoid.conf</code> and complete your path variables as follows:</p>
<div class="fragment"><div class="line">pathVariables:</div><div class="line">  MODEL:</div><div class="line">    - <span class="stringliteral">&quot;/usr/local/share/OpenHRP-3.1/sample/model&quot;</span></div><div class="line">    - <span class="stringliteral">&quot;/usr/local/share/OpenHRP-3.1/robot&quot;</span></div></div><!-- fragment --><p>Make sure your omniORB naming service is started by running the <code>reset-omninames.sh</code> script from your Choreonoid build folder. This script may be useful more than once so we might as well install it:</p>
<div class="fragment"><div class="line">ayumi:~/Software/choreonoid/build/bin$ sudo cp reset-omninames.sh /usr/local/bin/reset-omninames</div><div class="line">ayumi:~/Software/choreonoid/build/bin$ reset-omninames</div><div class="line">   Stopping omniORB name server omniNames                                               [ OK ]</div><div class="line">   Starting omniORB name server omniNames                                               [ OK ]</div></div><!-- fragment --><p>You should now be able to run the simulation by (note that you need to be in that specific folder for the Choreonoid simulation to start successfully):</p>
<div class="fragment"><div class="line">ayumi:/usr/local/share/hrpsys/samples/JVRC1$ choreonoid --start-simulation sim_mc.cnoid</div></div><!-- fragment --><h1><a class="anchor" id="config"></a>
Configuring and running the controller</h1>
<p>Write the following in your <code>~/.config/mc_rtc/mc_rtc.conf</code> configuration:</p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;Enabled&quot;</span>: [<span class="stringliteral">&quot;LIPMWalking&quot;</span>],</div><div class="line">  <span class="stringliteral">&quot;MainRobot&quot;</span>: <span class="stringliteral">&quot;JVRC1&quot;</span></div><div class="line">}</div></div><!-- fragment --><p>Almost there! We can finally:</p>
<ul>
<li>Start the RViz GUI: <div class="fragment"><div class="line">ayumi:~$ roslaunch lipm_walking_controller display.launch robot:=jvrc1</div></div><!-- fragment --></li>
<li>Start the Choreonoid simulation: <div class="fragment"><div class="line">ayumi:~/Software/choreonoid/build/bin$ sudo reset-omninames</div><div class="line">ayumi:/usr/local/share/hrpsys/samples/JVRC1$ choreonoid --start-simulation sim_mc.cnoid</div></div><!-- fragment --></li>
</ul>
<p>If everything worked well (as in the Docker) you should get something like this:</p>
<div class="image">
<img src="https://user-images.githubusercontent.com/1189580/69481155-04de3500-0e52-11ea-91cc-02d05d504ffa.png" style="max-height: 42em" align="left"/>
</div>
 <div style="clear: both"></div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 16 2019 02:34:56 for lipm_walking_controller by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
