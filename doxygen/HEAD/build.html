<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.17"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Build and install the LIPMWalking controller - LIPM Walking Documentation</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link href="doxygen.css" rel="stylesheet" type="text/css">
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX","output/SVG"],
      });
    </script>
    <script src="MathJax/MathJax.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <style type="text/css">
      #projectname {
        font-size: 200%;
      }
      #projectname a {
        color: #78B;
        font-family: monospace;
        font-size: 110%;
        font-stretch: semi-condensed;
        font-weight: bold;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectalign" style="padding: 0.5em 1em;">
              <div id="projectname">
                <a href="index.html">
                  lipm_walking_controller
                </a>
                <span id="projectnumber">
                  1.6.0
                </span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('build.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Build and install the LIPMWalking controller </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In what follows, we assume we are starting from a fresh and up-to-date Ubuntu LTS system.</p>
<h1><a class="anchor" id="controller"></a>
Building the controller</h1>
<p>You first need to install all required dependencies either from our <a class="el" href="build.html#binaries">Ubuntu mirrors</a> or from <a class="el" href="build.html#source">source</a>.</p>
<p>Assuming all dependencies are installed, we can install the lipm_walking_controller:</p>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/jrl-umi3218/lipm_walking_controller/ ~/devel/src/lipm_walking_controller</span></div>
<div class="line">mkdir -p ~/devel/src/lipm_walking_controller/build</div>
<div class="line">cd ~/devel/src/lipm_walking_controller/build</div>
<div class="line">cmake ../ -DCMAKE_BUILD_TYPE=RelWithDebInfo</div>
<div class="line">make -j`nproc`</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h1><a class="anchor" id="jvrc"></a>
Simulation with the JVRC-1 model</h1>
<p>First edit <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader.">mc_rtc</a> configuration to make use of the newly installed controller, edit ~/.config/mc_rtc/mc_rtc.yaml:</p>
<div class="fragment"><div class="line">MainRobot: JVRC1</div>
<div class="line">Enabled: LIPMWalking</div>
</div><!-- fragment --><p>Then start the RViZ GUI:</p>
<div class="fragment"><div class="line">roslaunch mc_rtc_ticker display.launch</div>
</div><!-- fragment --><p>You can keep RViZ running between simulations.</p>
<p>Go the project folder for JVRC1:</p>
<div class="fragment"><div class="line">cd /usr/share/hrpsys/samples/JVRC1</div>
</div><!-- fragment --><p>Restart the CORBA nameserver:</p>
<div class="fragment"><div class="line">./clear-omninames.sh</div>
<div class="line">[ ok ] Stopping omniorb4-nameserver (via systemctl): omniorb4-nameserver.servic.</div>
<div class="line">[ ok ] Starting omniorb4-nameserver (via systemctl): omniorb4-nameserver.service.</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.745670: Data file: <span class="stringliteral">&#39;/var/lib/omniorb/omninames-tstation.dat&#39;</span>.</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.745771: Starting omniNames for the first time.</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.745877: Wrote initial data file <span class="stringliteral">&#39;/var/lib/omniorb/omninames-tstation.dat&#39;</span>.</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.745909: Read data file <span class="stringliteral">&#39;/var/lib/omniorb/omninames-tstation.dat&#39;</span> successfully.</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.745935: Root context is IOR:010000002b00000049444c3a6f6d672e6f72672f436f734e616d696e672f4e616d696e67436f6e746578744578743a312e300000010000000000000070000000010102000b00000031302e312e37362e37310000f90a00000b0000004e616d6553657276696365000300000000000000080000000100000000545441010000001c000000010000000100010001000000010001050901010001000000090101000354544108000000b4d30e5e010033dc</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.745954: Checkpointing Phase 1: Prepare.</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.745986: Checkpointing Phase 2: Commit.</div>
<div class="line">omniNames: (0) 2020-01-03 13:40:04.746015: Checkpointing completed.</div>
</div><!-- fragment --><p>The output should look similar to the one above. If you see any errors then try again.</p>
<p>You should now be able to run the simulation by (note that you need to be in that specific folder for the Choreonoid simulation to start successfully):</p>
<div class="fragment"><div class="line">choreonoid --start-simulation sim_mc.cnoid</div>
</div><!-- fragment --><p>If everything worked well you should get something like this:</p>
<p><img src="https://user-images.githubusercontent.com/1189580/69481155-04de3500-0e52-11ea-91cc-02d05d504ffa.png" alt="" style="max-height: 42em" align="left" class="inline"/> </p><div style="clear: both"></div><h1><a class="anchor" id="binaries"></a>
Install dependencies from Ubuntu mirror</h1>
<p>Assuming you have already <a href="https://wiki.ros.org/Installation/Ubuntu">installed ROS</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Make sure you have required tools</span></div>
<div class="line">sudo apt-get -qq install apt-transport-https lsb-release ca-certificates gnupg</div>
<div class="line"><span class="preprocessor"># Add our key</span></div>
<div class="line">sudo apt-key adv --keyserver <span class="stringliteral">&#39;hkp://keyserver.ubuntu.com:80&#39;</span> --recv-key 892EA6EE273707C6495A6FB6220D644C64666806</div>
<div class="line"><span class="preprocessor"># Add our repository (head versions)</span></div>
<div class="line">sudo sh -c <span class="stringliteral">&#39;echo &quot;deb https://dl.bintray.com/gergondet/multi-contact-head $(lsb_release -sc) main&quot; | sudo tee /etc/apt/sources.list.d/multi-contact.list&#39;</span></div>
<div class="line"><span class="preprocessor"># Update packages list</span></div>
<div class="line">sudo apt-get -qq update</div>
<div class="line"><span class="preprocessor"># Install required dependencies, Choreonoid, JVRC1 sample project and mc_rtc tools</span></div>
<div class="line"><span class="preprocessor">sudo apt install libeigen3-dev doxygen libboost-all-dev libmc-rtc-dev libcopra-dev mc-openrtm jvrc-choreonoid mc-rtc-utils ros-${ROS_DISTRO}-mc-rtc-tools</span></div>
</div><!-- fragment --><p>You can now <a class="el" href="build.html#controller">build the controller</a> and <a class="el" href="build.html#jvrc">run a simulation</a>.</p>
<h1><a class="anchor" id="source"></a>
Install dependencies from source</h1>
<h2><a class="anchor" id="jrl"></a>
JRL dependencies</h2>
<p>Suppose we keep source software repositories in <code>~/devel/src</code>. We first clone <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader.">mc_rtc</a> and run its build script to get started:</p>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/jrl-umi3218/mc_rtc ~/devel/src/mc_rtc</span></div>
<div class="line">cd ~/devel/src/<a class="code" href="namespacemc__rtc.html">mc_rtc</a>/<a class="code" href="namespaceutils.html">utils</a></div>
<div class="line">./build_and_install.sh</div>
</div><!-- fragment --><p>This script will take care of building <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader.">mc_rtc</a>, its dependencies and the ROS tools required to enjoy the full functionalities of the controller.</p>
<p>We also have to build:</p><ul>
<li><a href="https://github.com/jrl-umi3218/eigen-quadprog/">eigen-quadprog</a>: quadratic programming</li>
<li><a href="https://github.com/jrl-umi3218/copra/">copra</a>: linear model predictive control</li>
</ul>
<p>For eigen-quadprog:</p>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/jrl-umi3218/eigen-quadprog ~/devel/src/eigen-quadprog</span></div>
<div class="line">mkdir -p ~/devel/src/eigen-quadprog/build</div>
<div class="line">cd ~/devel/src/eigen-quadprog/build</div>
<div class="line">cmake ../ -DCMAKE_BUILD_TYPE=RelWithDebInfo</div>
<div class="line">make -j`nproc`</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><p>And then copra:</p>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/jrl-umi3218/copra ~/devel/src/copra</span></div>
<div class="line">mkdir -p ~/devel/src/copra/build</div>
<div class="line">cd ~/devel/src/copra/build</div>
<div class="line">cmake ../ -DCMAKE_BUILD_TYPE=RelWithDebInfo</div>
<div class="line">make -j`nproc`</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h2><a class="anchor" id="choreonoid_build"></a>
Building Choreonoid</h2>
<p>You can test the controller in simulation using Choreonoid and the AIST dynamics simulator. First, install the following packages:</p>
<div class="fragment"><div class="line">sudo apt-get install -y f2c gettext liblapack-dev libomniorb4-dev libyaml-dev omniidl omniidl-python software-properties-common</div>
</div><!-- fragment --><p>Install OpenRTM-aist 1.1.2 packages (manually distributed...):</p>
<div class="fragment"><div class="line">wget https:<span class="comment">//github.com/OpenRTM/OpenRTM-aist/releases/download/svn/RELEASE_1_1_2/OpenRTM-aist_1.1.2_ubuntu`lsb_release -rs`_amd64_package.tar.gz</span></div>
<div class="line">tar xvzf OpenRTM-aist_1.1.2_ubuntu`lsb_release -rs`_amd64_package.tar.gz</div>
<div class="line">cd OpenRTM-aist_1.1.2_ubuntu`lsb_release -rs`_amd64_package</div>
<div class="line">sudo dpkg -i *.deb</div>
</div><!-- fragment --><div class="fragment"><div class="line">wget https:<span class="comment">//github.com/OpenRTM/OpenRTM-aist-Python/releases/download/svn%252FRELEASE_1_1_2/OpenRTM-aist-Python_1.1.2_ubuntu`lsb_release -rs`_amd64_package.tar.gz</span></div>
<div class="line">tar zxvf OpenRTM-aist-Python_1.1.2_ubuntu`lsb_release -rs`_amd64_package.tar.gz</div>
<div class="line">cd OpenRTM-aist-Python_1.1.2_ubuntu`lsb_release -rs`_amd64_package</div>
<div class="line">sudo dpkg -i *.deb</div>
</div><!-- fragment --><p>Install the <a href="https://github.com/fkanehiro/openhrp3">OpenHRP3</a> library:</p>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/fkanehiro/openhrp3.git ~/devel/src/openhrp3</span></div>
<div class="line">mkdir -p ~/devel/src/openhrp3/build</div>
<div class="line">cd ~/devel/src/openhrp3/util</div>
<div class="line">./installPackages.sh packages.list.ubuntu.`lsb_release -rs`</div>
<div class="line">cd ../build</div>
<div class="line">cmake .. -DCMAKE_BUILD_TYPE=RelWithDebInfo</div>
<div class="line">make -j`nproc`</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><p>Install the <a href="https://github.com/fkanehiro/hrpsys-base">hrpsys-base</a> suite of OpenRTM components:</p>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/fkanehiro/hrpsys-base.git ~/devel/src/hrpsys-base</span></div>
<div class="line">mkdir -p ~/devel/src/hrpsys-base/build</div>
<div class="line">cd ~/devel/src/hrpsys-base/build</div>
<div class="line">cmake .. -DCMAKE_BUILD_TYPE=RelWithDebInfo</div>
<div class="line">make -j`nproc`</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><p>Install <a href="https://github.com/s-nakaoka/choreonoid">Choreonoid</a>:</p>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/s-nakaoka/choreonoid.git ~/devel/src/choreonoid</span></div>
<div class="line">mkdir -p ~/devel/src/choreonoid/build</div>
<div class="line">cd ~/devel/src/choreonoid/build</div>
<div class="line">cmake .. -DCMAKE_BUILD_TYPE=RelWithDebInfo</div>
<div class="line">make -j`nproc`</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h2><a class="anchor" id="mc_openrtm"></a>
Install mc_openrtm and the sample project</h2>
<p>We will need an interface to communicate with our simulated robots. Install the following:</p>
<ul>
<li><a href="https://github.com/jrl-umi3218/mc_openrtm">mc_openrtm</a>: OpenRTM interface to connect <a class="el" href="namespacemc__rtc.html" title="Framework namespace, only used to add a configuration loader.">mc_rtc</a> with the Choreonoid simulation</li>
</ul>
<div class="fragment"><div class="line">git clone --recursive https:<span class="comment">//github.com/jrl-umi3218/mc_openrtm ~/devel/src/mc_openrtm</span></div>
<div class="line">mkdir -p ~/devel/src/mc_openrtm/build</div>
<div class="line">cd ~/devel/src/mc_openrtm/build</div>
<div class="line">cmake ../ -DCMAKE_BUILD_TYPE=RelWithDebInfo</div>
<div class="line">make -j`nproc`</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><p>This will install the interface along with a sample project for the JVRC1 robot.</p>
<p>You can now <a class="el" href="build.html#controller">build the controller</a> and <a class="el" href="build.html#jvrc">run a simulation</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespaceutils_html"><div class="ttname"><a href="namespaceutils.html">utils</a></div><div class="ttdoc">Utility functions and classes.</div><div class="ttdef"><b>Definition:</b> <a href="clamp_8h_source.html#l00035">clamp.h:35</a></div></div>
<div class="ttc" id="anamespacemc__rtc_html"><div class="ttname"><a href="namespacemc__rtc.html">mc_rtc</a></div><div class="ttdoc">Framework namespace, only used to add a configuration loader.</div><div class="ttdef"><b>Definition:</b> <a href="_contact_8h_source.html#l00333">Contact.h:333</a></div></div>
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jan 31 2024 09:14:48 for lipm_walking_controller by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
